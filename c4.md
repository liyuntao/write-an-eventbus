# 功能增强

## 进阶demo

前面的章节，我们实现了一个简陋的EventBus。在用于生产环境前，还需要完善一些功能与细节。看下面这段稍稍进阶的Guava/EventBus demo：

```java
import com.google.common.eventbus.EventBus;
import com.google.common.eventbus.Subscribe;

class Base {
    @Subscribe
    public void onEvent(String s) {
        System.out.println("str from base: " + s);
    }
}

public class TestGuavaEventBus extends Base{
    public static void main(String[] args) {
        EventBus bus = new EventBus();
        bus.register(new TestGuavaEventBus());
        bus.post(10086);
        System.out.println("------------");
        bus.post("hey hey");
    }

    @Subscribe
    public void onEvent00(String s) {
        System.out.println("str: " + s);
    }

    @Subscribe
    public void onEvent01(Object o) {
        System.out.println("obj: " + o);
    }

    @Subscribe
    public void onEvent02(Number n) {
        System.out.println("num: " + n);
    }

    @Subscribe
    public void onEvent03(Integer i) {
        System.out.println("int: " + i);
    }

}
```

这段demo中，使用了4个不同参数的方法来接收事件。同时注意到，实现类有一个继承结构，其基类中也有一个方法打了@Subscribe注解

执行，结果如下：
> int: 10086 </br>
> num: 10086 </br>
> obj: 10086 </br>------------</br>
> str: hey hey </br>
> str from base: hey hey </br>
> obj: hey hey

执行结果表示，在Guava/EventBus中，支持两个特性： 
 
* 支持基类订阅方法：在注册时，订阅者实例父类中的订阅方法同样也会接收event 
* Event的继承匹配：调用`post()`时，event对象继承链上的类型都会收到事件。如demo所示，存在Integer->Number->Object这样一组继承关系，当post一个Integer的event时，若存在参数类型为Number或Object的订阅方法，这些方法同样能接收到Integer事件。 
 
## 实现支持基类订阅方法 

 ```java
     private List<Class<?>> getSuperClass(Class<?> type) {
        List<Class<?>> result = new ArrayList<>();
        result.add(type);
        while(type != Object.class) {
            type = type.getSuperclass();
            result.add(type);
        }
        return result;
    }
 ```

<!--继承链post-->
<!--线程安全，优化（缓存）-->
<!--异常处理-->
